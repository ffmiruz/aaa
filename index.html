<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Bright and Happy Light Mode Color Palette */
            --color-primary-glow: #007BFF; /* Bright, classic blue */
            --color-primary-glow-rgb: 0, 123, 255;
            --color-primary-medium: #0069D9;
            --color-primary-dark: #0056B3;

            --color-accent-glow: #28A745; /* Cheerful green */
            --color-accent-glow-rgb: 40, 167, 69;
            --color-accent-medium: #218838;
            --color-accent-dark: #1E7E34;

            --color-background-page: #FFFFFF; /* Pure white for page background */
            --color-background-page-rgb: 255, 255, 255;
            --color-background-panel: #FFFFFF; /* Pure white for panels */
            --color-background-panel-rgb: 255, 255, 255;

            --color-panel-border: #DEE2E6; /* Light gray border (Bootstrap-like) */
            --color-panel-border-light: #F1F3F5;

            --color-text-primary: #212529;    /* Standard dark text for readability */
            --color-text-secondary: #6C757D;  /* Standard secondary text */
            --color-text-heading: #212529;
            --color-text-on-primary-bg: #FFFFFF;

            --color-input-bg: #FFFFFF;
            --color-input-border: #CED4DA; /* Standard input border */
            --color-input-focus-border: var(--color-primary-glow);
            --color-input-text: #212529;
            --color-input-placeholder: #6C757D;

            --color-error: #DC3545; /* Standard error red */
            --color-error-bg: #F8D7DA; /* Light red background for error messages */
            --color-error-border: #F5C6CB;
            --color-error-text: #721C24;


            --color-code-bg: #F8F9FA;       /* Very light gray for code background */
            --color-code-text: #212529;
            --color-code-action-bar-bg: #E9ECEF;

            --color-disabled-bg: #E9ECEF;
            --color-disabled-text: #6C757D;
            --color-disabled-border: #CED4DA;

            /* Typography */
            --font-family-display: "Inter", "Exo 2", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-family-sans: "Inter", "Exo 2", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-family-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;

            --font-size-base: 16px;
            --line-height-base: 1.6;
            --line-height-code: 1.5;

            --font-weight-light: 300;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;

            /* Spacing & Sizing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 0.75rem;
            --spacing-lg: 1rem;
            --spacing-xl: 1.5rem;
            --spacing-2xl: 2rem;
            --spacing-3xl: 2.5rem;

            --border-radius-sm: 0.2rem;  /* Slightly less rounded for a crisp look */
            --border-radius-md: 0.25rem;
            --border-radius-lg: 0.3rem;

            /* Effects - Subtle shadows */
            --shadow-focus-ring-primary: 0 0 0 0.2rem rgba(var(--color-primary-glow-rgb), 0.25);
            --shadow-focus-ring-accent: 0 0 0 0.2rem rgba(var(--color-accent-glow-rgb), 0.25);
            --shadow-sm: 0 .125rem .25rem rgba(0,0,0,.075);
            --shadow-md: 0 .5rem 1rem rgba(0,0,0,.10);
            --shadow-panel: var(--shadow-sm);
            --shadow-header: 0 2px 4px rgba(0,0,0,.04); /* Very subtle header shadow */
            --shadow-button: var(--shadow-sm);

            --transition-fast: 0.15s ease-out;
            --transition-medium: 0.2s ease-out;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        html {
            font-family: var(--font-family-sans);
            line-height: var(--line-height-base);
            color: var(--color-text-primary);
            background-color: var(--color-background-page);
            font-size: var(--font-size-base);
            scrollbar-width: thin;
            scrollbar-color: #AEB6BF var(--color-background-page); /* Neutral scrollbar */
        }
        html::-webkit-scrollbar { width: 10px; }
        html::-webkit-scrollbar-track { background: #F1F3F5; }
        html::-webkit-scrollbar-thumb {
            background-color: #AEB6BF;
            border-radius: var(--border-radius-sm);
            border: 2px solid #F1F3F5;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
        }

        header {
            background: var(--color-background-panel);
            color: var(--color-text-heading);
            padding: var(--spacing-lg) var(--spacing-2xl);
            text-align: center;
            border-bottom: 1px solid var(--color-panel-border);
            box-shadow: var(--shadow-header);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        header h1 {
            font-family: var(--font-family-display);
            font-size: 1.75rem;
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-heading);
        }

        main {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-xl);
            position: relative;
            z-index: 5;
        }

        .input-section, .content-display-area {
            padding: var(--spacing-xl);
            background: var(--color-background-panel);
            border: 1px solid var(--color-panel-border);
            box-shadow: var(--shadow-panel);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
        }
        .content-display-area {
            overflow: hidden;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        #urlForm { display: flex; gap: var(--spacing-lg); align-items: center; flex-wrap: wrap; }

        #urlForm label {
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        #urlInput {
            flex-grow: 1;
            padding: 0.5rem 0.75rem; /* Standard padding */
            border: 1px solid var(--color-input-border);
            background-color: var(--color-input-bg);
            color: var(--color-input-text);
            font-size: var(--font-size-base);
            min-width: 280px;
            transition: border-color var(--transition-medium), box-shadow var(--transition-medium);
            border-radius: var(--border-radius-md);
            line-height: 1.5; /* Ensure consistent height */
        }
        #urlInput::placeholder { color: var(--color-input-placeholder); opacity: 1; }

        #urlInput:focus {
            outline: none;
            border-color: var(--color-input-focus-border);
            box-shadow: var(--shadow-focus-ring-primary);
        }

        button {
            padding: 0.5rem 1rem; /* Standard button padding */
            border: 1px solid var(--color-input-border);
            border-radius: var(--border-radius-md);
            font-size: 0.95rem;
            font-family: var(--font-family-sans);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-medium);
            background: var(--color-background-panel);
            color: var(--color-text-primary);
            box-shadow: var(--shadow-button);
            line-height: 1.5; /* Ensure consistent height */
        }
        button:hover:not(:disabled) {
            border-color: #ADB5BD; /* Slightly darker border on hover */
            color: var(--color-text-primary);
            background-color: #F8F9FA; /* Very light gray hover */
        }
        button:active:not(:disabled) {
            background-color: #E9ECEF;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
            transform: translateY(1px);
        }

        button[type="submit"] {
            background: var(--color-primary-medium);
            color: var(--color-text-on-primary-bg);
            border-color: var(--color-primary-medium);
            font-weight: var(--font-weight-semibold);
        }
        button[type="submit"]:hover:not(:disabled) {
            background: var(--color-primary-glow);
            border-color: var(--color-primary-glow);
            color: var(--color-text-on-primary-bg);
        }
        button[type="submit"]:focus-visible:not(:disabled) {
            box-shadow: var(--shadow-button), var(--shadow-focus-ring-primary);
        }

        .message-box {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-lg);
            text-align: center;
            font-weight: var(--font-weight-normal);
            border-radius: var(--border-radius-md);
            border: 1px solid;
        }
        .error-message {
            color: var(--color-error-text);
            background-color: var(--color-error-bg);
            border-color: var(--color-error-border);
        }

        .view-toggle-controls {
            margin-bottom: var(--spacing-md);
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-xs);
            background: #F1F3F5; /* Lightest gray for toggle area */
            justify-content: center;
            align-items: center;
            border: none;
            border-radius: var(--border-radius-md);
        }
        .view-toggle-controls button {
            font-size: 0.9rem;
            background: transparent;
            box-shadow: none;
            border-color: transparent;
            color: var(--color-text-secondary);
            padding: 0.4rem 0.8rem;
        }
        .view-toggle-controls button:hover:not(:disabled) {
            color: var(--color-primary-glow);
            background: rgba(var(--color-primary-glow-rgb), 0.08);
            box-shadow: none;
        }
        .view-toggle-controls button.active {
            background: var(--color-background-panel);
            color: var(--color-primary-glow);
            box-shadow: var(--shadow-sm);
        }
        .view-toggle-controls button:disabled, button:disabled {
            background: var(--color-disabled-bg) !important;
            color: var(--color-disabled-text) !important;
            border-color: transparent !important; /* No border for disabled toggle */
            cursor: not-allowed;
            box-shadow: none !important;
            transform: none !important;
            opacity: 0.65;
        }

        .code-actions-bar {
            display: flex;
            justify-content: flex-end;
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--color-code-action-bar-bg);
            border-bottom: 1px solid var(--color-panel-border);
        }
        .content-display-area > .codeViewWrapper > .code-actions-bar {
             border-top-left-radius: var(--border-radius-lg);
             border-top-right-radius: var(--border-radius-lg);
        }

        #copyCodeButton {
            font-size: 0.9rem;
            background: var(--color-accent-medium);
            color: var(--color-text-on-primary-bg);
            border-color: var(--color-accent-medium);
        }
        #copyCodeButton:hover:not(:disabled) {
            background: var(--color-accent-glow);
            border-color: var(--color-accent-glow);
            color: var(--color-text-on-primary-bg);
        }
        #copyCodeButton:focus-visible:not(:disabled) {
            box-shadow: var(--shadow-button), var(--shadow-focus-ring-accent);
        }

        #contentFrame {
            height: 100vh;
            width: 100%;
            flex-grow: 1;
            border: none;
            background-color: var(--color-background-panel);
        }
        .content-display-area > #contentFrame:only-child {
            border-radius: inherit;
        }

        #codeViewWrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            background-color: var(--color-code-bg);
            border-radius: inherit;
        }
        .content-display-area #codeViewWrapper:not(.hidden) {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border-bottom-left-radius: var(--border-radius-lg);
            border-bottom-right-radius: var(--border-radius-lg);
        }
        .content-display-area > #codeViewWrapper:only-child {
            border-radius: var(--border-radius-lg);
        }
        .content-display-area #codeViewWrapper:not(.hidden) .code-actions-bar {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
         .content-display-area > #codeViewWrapper:only-child .code-actions-bar {
            border-top-left-radius: var(--border-radius-lg);
            border-top-right-radius: var(--border-radius-lg);
        }

        #codeViewSection {
            flex-grow: 1;
            width: 100%;
            overflow: auto;
            color: var(--color-code-text);
            padding: var(--spacing-lg);
            line-height: var(--line-height-code);
        }
        #codeViewSection pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: var(--font-family-mono);
            font-size: 0.9em;
        }

        .hidden { display: none !important; }

        footer {
            padding: var(--spacing-xl) var(--spacing-xl);
            text-align: center;
            border-top: 1px solid var(--color-panel-border);
            margin-top: var(--spacing-2xl);
            background: var(--color-background-page);
        }

        footer .email-link {
            font-family: var(--font-family-sans);
            font-size: 0.9rem;
            font-weight: var(--font-weight-medium);
            color: var(--color-primary-glow);
            text-decoration: none;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius-md);
            transition: all var(--transition-medium);
            display: inline-block;
            border: 1px solid transparent;
        }

        footer .email-link:hover,
        footer .email-link:focus {
            color: var(--color-primary-dark);
            background-color: rgba(var(--color-primary-glow-rgb), 0.08);
            outline: none;
        }

        @media (max-width: 768px) {
            header h1 { font-size: 1.6rem; }
            main { padding: var(--spacing-xl) var(--spacing-lg); }
            .input-section { padding: var(--spacing-lg); }
            #urlForm { flex-direction: column; align-items: stretch; }
            #urlInput { width: 100%; margin-bottom: var(--spacing-md); min-width: 0; }
            #urlForm label { margin-bottom: var(--spacing-sm); text-align: left; }
            button[type="submit"] { width: 100%; }
            .view-toggle-controls button { font-size: 0.85rem; padding: 0.35rem 0.7rem; }
            #codeViewSection { padding: var(--spacing-md); font-size: 0.85em; }
            footer { padding: var(--spacing-lg) var(--spacing-lg); }
        }
        @media (max-width: 480px) {
            header { padding: var(--spacing-md) var(--spacing-md); }
            header h1 { font-size: 1.5rem; }
            main { padding: var(--spacing-lg) var(--spacing-sm); }
            .input-section { padding: var(--spacing-md); }
            button { font-size: 0.9rem; }
            .view-toggle-controls button { font-size: 0.8rem; padding: 0.3rem 0.6rem;}
            #codeViewSection { padding: var(--spacing-sm); font-size: 0.8em; }
            #copyCodeButton { width: 100%;}
            footer .email-link {
                font-size: 0.85rem;
                width: calc(100% - var(--spacing-md));
                box-sizing: border-box;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Demo</h1>
    </header>

    <main>
        <section class="input-section">
            <form id="urlForm">
                <label for="urlInput">Enter Query:</label>
                <input type="text" id="urlInput" name="url" placeholder="“I’m looking for impactful startups with current initiatives to fund." required>
                <button type="submit">✨ Generate ✨</button>
            </form>
            <div id="errorMessage" class="message-box error-message hidden"></div>
        </section>

        <div class="view-toggle-controls">
            <button id="previewButton" class="active">Preview</button>
            <button id="codeViewButton" disabled>View Code</button>
        </div>

        <section class="content-display-area">
            <iframe id="contentFrame" title="Loaded Content" sandbox="allow-scripts allow-same-origin allow-popups allow-forms">
            </iframe>

            <div id="codeViewWrapper" class="hidden">
                <div class="code-actions-bar">
                    <button id="copyCodeButton" title="Copy HTML code to clipboard">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: -0.125em; margin-right: 6px;">
                            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                        </svg>
                        Copy Code
                    </button>
                </div>
                <div id="codeViewSection">
                    <pre><code id="htmlCodeContent"></code></pre>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <a href="mailto:rapidoz@msn.com" class="email-link" title="Get in touch!">rapidoz@msn.com</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlForm = document.getElementById('urlForm');
            const urlInput = document.getElementById('urlInput');
            const contentFrame = document.getElementById('contentFrame');
            const errorMessage = document.getElementById('errorMessage');
            const previewButton = document.getElementById('previewButton');
            const codeViewButton = document.getElementById('codeViewButton');
            const codeViewWrapper = document.getElementById('codeViewWrapper');
            const htmlCodeContent = document.getElementById('htmlCodeContent');
            const copyCodeButton = document.getElementById('copyCodeButton');
            const submitButton = urlForm.querySelector('button[type="submit"]');

            let lastFetchedHtml = '';
            let currentViewMode = 'preview';
            let currentSuccessfullyLoadedUrl = '';

            const loadingAnimationHtml = `
                <!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
                <style>
                    :root {
                        --loader-primary-glow-rgb: ${getComputedStyle(document.documentElement).getPropertyValue('--color-primary-glow-rgb').trim() || '0, 123, 255'};
                        --loader-text: ${getComputedStyle(document.documentElement).getPropertyValue('--color-text-primary').trim() || '#212529'};
                        --loader-bg: ${getComputedStyle(document.documentElement).getPropertyValue('--color-background-panel').trim() || '#FFFFFF'};
                        --font-family-sans: ${getComputedStyle(document.documentElement).getPropertyValue('--font-family-sans').trim() || '"Inter", "Exo 2", system-ui, sans-serif'};
                    }
                    body { margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; background-color: var(--loader-bg); overflow: hidden; font-family: var(--font-family-sans); align-items: flex-start; padding-top: 20vh; }
                    .loader-container { text-align: center; }
                    .pulsing-orb {
                        width: 36px; height: 36px; margin: 0 auto 20px auto;
                        border-radius: 50%;
                        border: 4px solid rgba(var(--loader-primary-glow-rgb), 0.2);
                        border-top-color: rgba(var(--loader-primary-glow-rgb), 1);
                        animation: spin 0.8s infinite linear;
                    }
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                    .loading-text { color: var(--loader-text); font-size: 1em; font-weight: 500; opacity: 0.8;}
                </style></head><body>
                <div class="loader-container">
                    <div class="pulsing-orb"></div>
                    <div class="loading-text">Calling LLM... Please Wait</div>
                </div>
                </body></html>`;

            function showIframeLoadingAnimation() {
                contentFrame.onload = null;
                contentFrame.srcdoc = loadingAnimationHtml;
                htmlCodeContent.textContent = '';
            }

            const iframeLoadedHandler = () => {
                 if (!contentFrame.contentWindow || !contentFrame.contentWindow.document) {
                    contentFrame.onload = null; return;
                }
                try {
                    const iframeDoc = contentFrame.contentWindow.document;
                    if (iframeDoc.body) {
                        iframeDoc.body.addEventListener('click', (e) => {
                            const linkElement = e.target.closest('a[href]');
                            if (linkElement) {
                                const rawHref = linkElement.getAttribute('href');
                                if (!rawHref || rawHref.startsWith('#')) { e.preventDefault(); return; }
                                const lowerRawHref = rawHref.toLowerCase();
                                const nonHijackablePrefixes = ['javascript:', 'mailto:', 'tel:', 'blob:', 'data:'];
                                if (nonHijackablePrefixes.some(prefix => lowerRawHref.startsWith(prefix))) { return; }
                                e.preventDefault();
                                if (urlInput.value.charAt(0) == '/') {
                                    urlInput.value = rawHref;
                                } else {
                                    try {
                                        let url = new URL("https://"+urlInput.value);
                                        urlInput.value = url.hostname+rawHref;
                                    }
                                    catch (e) {
                                        urlInput.value = rawHref;
                                    }
                                }
                                if (typeof urlForm.requestSubmit === 'function') { urlForm.requestSubmit(submitButton); } else { submitButton.click(); }
                            }
                        });
                    }
                } catch (iframeAccessError) { console.warn("Could not attach click listener to iframe.", iframeAccessError); }
                contentFrame.onload = null;
            };

            function displayError(message) {
                errorMessage.textContent = `Error: ${message}`;
                errorMessage.classList.remove('hidden');
            }

            function clearError() {
                errorMessage.classList.add('hidden');
                errorMessage.textContent = '';
            }

            function setInitialContentMessage(message, isError = false) {
                const docStyle = getComputedStyle(document.documentElement);
                const cssVars = `
                    --color-error-text: ${docStyle.getPropertyValue('--color-error-text').trim() || '#721C24'};
                    --color-error-bg: ${docStyle.getPropertyValue('--color-error-bg').trim() || '#F8D7DA'};
                    --color-error-border: ${docStyle.getPropertyValue('--color-error-border').trim() || '#F5C6CB'};
                    --color-text-secondary: ${docStyle.getPropertyValue('--color-text-secondary').trim() || '#6C757D'};
                    --color-background-panel: ${docStyle.getPropertyValue('--color-background-panel').trim() || '#FFFFFF'};
                    --font-family-sans: ${docStyle.getPropertyValue('--font-family-sans').trim() || '"Inter", "Exo 2", system-ui, sans-serif'};
                    --border-radius-md: ${docStyle.getPropertyValue('--border-radius-md').trim() || '0.25rem'};
                    --color-panel-border: ${docStyle.getPropertyValue('--color-panel-border').trim() || '#DEE2E6'};
                `;

                const placeholderStyle = `
                    padding: 20px; text-align: center; margin: 20px;
                    font-family: var(--font-family-sans);
                    color: ${isError ? 'var(--color-error-text)' : 'var(--color-text-secondary)'};
                    background-color: ${isError ? 'var(--color-error-bg)' : 'var(--color-background-panel)'};
                    border: 1px solid ${isError ? 'var(--color-error-border)' : 'var(--color-panel-border)'};
                    border-radius: var(--border-radius-md);
                `;
                const titleStyle = isError ? `margin-bottom: 10px; color: var(--color-error-text); font-family: var(--font-family-sans); font-weight:600;` : '';
                const titleHtml = isError ? `<h3 style="${titleStyle}">Error Display</h3>` : ''; // Changed "Error" to "Error Display" for clarity
                const processedMessage = isError ? message : `${message}`;

                const placeholderHtml = `
                    <html><head><style>:root { ${cssVars} }</style></head>
                    <body style="background-color: var(--color-background-panel); margin:0; padding-top: 10vh; color: var(--color-text-secondary);">
                        <div style="${placeholderStyle}">${titleHtml}<p style="opacity: 0.9;">${processedMessage}</p></div>
                    </body></html>`;

                contentFrame.onload = null;
                contentFrame.srcdoc = placeholderHtml;
                htmlCodeContent.textContent = '';
            }

            function updatePreviewView() {
                if (lastFetchedHtml && lastFetchedHtml.trim() !== '') {
                    contentFrame.onload = iframeLoadedHandler;
                    contentFrame.srcdoc = lastFetchedHtml;
                } else {
                    contentFrame.onload = null;
                    setInitialContentMessage('No content to display yet.');
                }
                contentFrame.classList.remove('hidden');
                codeViewWrapper.classList.add('hidden');
                previewButton.classList.add('active');
                codeViewButton.classList.remove('active');
                currentViewMode = 'preview';
            }

            function updateCodeView() {
                htmlCodeContent.textContent = lastFetchedHtml || 'No code to display.';
                contentFrame.classList.add('hidden');
                codeViewWrapper.classList.remove('hidden');
                previewButton.classList.remove('active');
                codeViewButton.classList.add('active');
                currentViewMode = 'code';
                copyCodeButton.disabled = !lastFetchedHtml;
                copyCodeButton.innerHTML = originalCopySVG;
            }

            urlForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                clearError();
                let urlFromInput = urlInput.value.trim();
                if (!urlFromInput) {
                    displayError('Please enter a valid URL.'); // Changed from "URL" to "query" for consistency with placeholder
                    urlInput.focus(); return;
                }
                showIframeLoadingAnimation();
                const originalSubmitText = submitButton.textContent;
                submitButton.textContent = 'Generating...';
                submitButton.disabled = true;
                previewButton.disabled = true;
                codeViewButton.disabled = true;
                copyCodeButton.disabled = true;

                try {
                    const response = await fetch(`/api?input=${encodeURIComponent(urlFromInput)}`, { method: 'POST', headers: { 'Accept': 'text/html' } });
                    if (!response.ok) {
                        let apiErrorMsg = `API request failed. Status: ${response.status}`;
                        try { const errorData = await response.json(); if (errorData && errorData.error) apiErrorMsg += ` - ${errorData.error}`; else if (errorData) apiErrorMsg += ` - ${JSON.stringify(errorData).substring(0,100)}`; } catch (e) { try { const errorText = await response.text(); if (errorText) apiErrorMsg += ` - ${errorText.substring(0, 200)}`; } catch (e2) { /* Ignore */ }}
                        throw new Error(apiErrorMsg);
                    }
                    const fetchedHtml = await response.text();
                    lastFetchedHtml = (fetchedHtml && fetchedHtml.trim()) ? fetchedHtml : '';
                    if (!lastFetchedHtml) setInitialContentMessage('Received empty HTML content.');
                    currentSuccessfullyLoadedUrl = urlFromInput;
                    previewButton.disabled = false; codeViewButton.disabled = false;
                    if (currentViewMode === 'preview') updatePreviewView(); else updateCodeView();
                } catch (error) {
                    displayError(`Failed to generate content: ${error.message}`);
                    console.error('Fetch error details:', error);
                    lastFetchedHtml = '';
                    setInitialContentMessage(`Error generating content: ${error.message}.`, true);
                    previewButton.disabled = true; codeViewButton.disabled = true; copyCodeButton.disabled = true;
                } finally {
                    submitButton.textContent = originalSubmitText; submitButton.disabled = false;
                }
            });

            previewButton.addEventListener('click', () => { if (!previewButton.disabled) updatePreviewView(); });
            codeViewButton.addEventListener('click', () => { if (!codeViewButton.disabled) updateCodeView(); });

            const originalCopySVG = `
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: -0.125em; margin-right: 6px;">
                    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                </svg>
                Copy Code`;
            const copiedSVG = `
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: -0.125em; margin-right: 6px;">
                   <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022z"/>
                </svg>
                Copied!`;
            const copyFailedSVG = `
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: -0.125em; margin-right: 6px;">
                   <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                </svg>
                Copy Failed`;

            copyCodeButton.addEventListener('click', async () => {
                if (!lastFetchedHtml || copyCodeButton.disabled) return;
                try {
                    await navigator.clipboard.writeText(lastFetchedHtml);
                    copyCodeButton.innerHTML = copiedSVG;
                    setTimeout(() => { copyCodeButton.innerHTML = originalCopySVG; }, 2000);
                } catch (err) {
                    console.error('Failed to copy code: ', err);
                     copyCodeButton.innerHTML = copyFailedSVG;
                     setTimeout(() => { copyCodeButton.innerHTML = originalCopySVG; }, 2000);
                }
            });

            urlInput.addEventListener('blur', () => {
                urlInput.value = urlInput.value.trim();
            });

            urlInput.focus();
            setInitialContentMessage("Enter what do you want to explore about the data");
            copyCodeButton.disabled = true;
        });
    </script>
</body>
</html>